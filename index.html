<!DOCTYPE html>

<html lang="en">
	<head>
		<title>jQuery Express.js File Upload</title>
		<meta charset="utf-8" />
        <link rel="icon" type="image/vnd.microsoft.icon" href="favicon.ico" />
	</head>

	<body>
		<h3>jQuery Express.js File Upload</h3>
		Select a file to upload:
		<br />

		<div>
			<h4>Case 1 : Using a Form</h4>
			<br />
			<!-- <form action="http://127.0.0.1:8081/file_upload" method="POST" enctype="multipart/form-data"> -->
			<!-- <form id="form" action="http://127.0.0.1:8081/file_upload" method="POST" enctype="application/x-www-form-urlencoded"> -->
			<!-- <form id="form" enctype="multipart/form-data" method="post"> -->
				<!-- <input type="file" name="file" size="50" /> -->
				<!-- <input type="file" id="file" name="file" required /> -->

				<!-- The <input> of type "file" must have a name; -->
				<!-- If it is named "foo", then the file data will be POSTed to the server as req.files.foo -->

				<input type="file" id="file" name="file" />
				<br />
				<!-- <input type="submit" value="Upload File" /> -->
				<input id="uploadButton" type="button" value="Upload File" />
			<!-- </form> -->
		</div>

		<div>
			<h4>Case 2 : Not Using a Form</h4>
			<br />
			<input type="file" id="fileNoForm" name="fileNoForm" />
			<br />
			<input id="uploadButtonNoForm" type="button" value="Upload File" />
		</div>

		<script type="text/javascript" src="/jquery.min.js"></script>
		<script>
			//$("#form").submit(function (event) {
			//	...
			//	$.post('file_upload', $('form').serialize());	// ?
			//	event.preventDefault();
			//});

			$("#uploadButtonNoForm").click(function () {
				console.log('#uploadButtonNoForm click');
				// See https://stackoverflow.com/questions/5392344/sending-multipart-formdata-with-jquery-ajax :
				var data = new FormData();
				//jQuery.each(jQuery('#file')[0].files, function(i, file) {
				//	data.append('file-'+i, file);
				//});

				// See https://stackoverflow.com/questions/6974684/how-to-send-formdata-objects-with-ajax-requests-in-jquery :
				const fileKeyName = 'fileNoForm';	// If fileKeyName is 'foo', the file data will be accessible in the server's app.post(req, res) event handler as req.files.foo
				var fileGoodness = $("#fileNoForm")[0].files[0];
				console.log('fileGoodness:', fileGoodness);
				data.append(fileKeyName, fileGoodness);

				$.ajax({
					url: '/noform',
					data: data,
					cache: false,
					processData: false,
					contentType: false,
					type: 'POST',
					success: function(result){
						alert('Ajax POST success! : ' + result);
					},
					error: function(error){
						//alert('Ajax POST error : ' + error);
						alert('Ajax POST error.');
					}
				});
			});
		</script>
	</body>
</html>
